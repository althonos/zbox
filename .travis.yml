sudo: false
language: python
cache:
  directories:
    - "$CARGO_HOME"
    - "$HOME/.pip/cache"

env:
  global:
    - RUSTC_WRAPPER="sccache"
    - CARGO_HOME="$HOME/.cargo"
    - SCCACHE_DIR="$CARGO_HOME/sccache"
    - PATH="$PATH:$CARGO_HOME/bin"
    - SODIUM_STATIC=true
    - SODIUM_LIB_DIR="$CARGO_HOME/lib"

stages:
  - test
  - deploy

.test: &test
  stage: test
  before_install:
    - ci/travis/setup.sh
  install:
    - pip install -U setuptools setuptools-rust
  script:
    - python setup.py test


jobs:
  include:

    # Tests
    - python: 2.7
      <<: *test
    - python: 3.5
      <<: *test
    - python: 3.6
      <<: *test

    # Wheels
    - stage: deploy
      os: linux
      sudo: required
      services:
        - docker
      env:
        - IMAGE=quay.io/pypa/manylinux1_x86_64
      install:
        - docker pull $IMAGE
      script:
        - docker run --rm -v `pwd`:/io $IMAGE /io/ci/travis/wheels-linux.sh
        - ls dist

notifications:
  email:
  - althonosdev@gmail.com
